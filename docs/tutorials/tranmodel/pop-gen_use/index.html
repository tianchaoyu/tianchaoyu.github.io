<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="zh-CN" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>popgen-人口合成 - 技术博客</title>
<meta name="description" content="1、项目结构及配置参数 1.1、项目目录">


  <meta name="author" content="tianchaoyu">
  
  <meta property="article:author" content="tianchaoyu">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="zh_CN">
<meta property="og:site_name" content="技术博客">
<meta property="og:title" content="popgen-人口合成">
<meta property="og:url" content="http://localhost:4000/tutorials/tranmodel/pop-gen_use/">


  <meta property="og:description" content="1、项目结构及配置参数 1.1、项目目录">



  <meta property="og:image" content="http://localhost:4000/assets/images/site-logo.jpg">





  <meta property="article:published_time" content="2025-03-07T17:38:38+08:00">






<link rel="canonical" href="http://localhost:4000/tutorials/tranmodel/pop-gen_use/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="技术博客 Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">转到主导航栏</a></li>
    <li><a href="#main" class="screen-reader-shortcut">转到内容</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">转到底部</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          技术博客
          <span class="site-subtitle">一名交通模数师的日常</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/tools/"
                 title="工具软件介绍"
                
              >Tools</a>
            </li><li class="masthead__menu-item">
              <a
                href="/theme/"
                 title="交通专题库"
                
              >Theme</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tutorials/"
                 title="知识库"
                
              >Tutorials</a>
            </li><li class="masthead__menu-item">
              <a
                href="/about/"
                 title="关于博主"
                
              >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">切换搜索</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">切换菜单</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      <nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">切换菜单</label>
  <ul class="nav__items">
    
      
      
        <li>
          
            <a href="/tutorials/tranmodel/fourstep/"><span class="nav__sub-title">四阶段交通模型</span></a>
          

          
          <ul>
            
              <li><a href="/tutorials/tranmodel/fourstep/">理论基础</a></li>
            
              <li><a href="/tutorials/tranmodel/trip_generate/">出行生成</a></li>
            
              <li><a href="/tutorials/tranmodel/trip_distribution/">交通分布</a></li>
            
              <li><a href="/tutorials/tranmodel/mode_split/">方式划分</a></li>
            
              <li><a href="/tutorials/tranmodel/PA2OD/">PA2OD</a></li>
            
              <li><a href="/tutorials/tranmodel/transport-assignment/">交通分配</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <span class="nav__sub-title">出行链交通模型</span>
          

          
          <ul>
            
              <li><a href="/tutorials/tranmodel/tourbase/">理论基础</a></li>
            
              <li><a href="/tutorials/tranmodel/tour-generate/">出行链生成</a></li>
            
              <li><a href="/tutorials/tranmodel/utility-calculate/">效用计算</a></li>
            
              <li><a href="/tutorials/tranmodel/destination-choice/">目的地选择</a></li>
            
              <li><a href="/tutorials/tranmodel/Intermediate-stop/">中间停留点模型</a></li>
            
              <li><a href="/tutorials/tranmodel/half-tour/">半程出行链</a></li>
            
              <li><a href="/tutorials/tranmodel/mode-choice/">方式选择</a></li>
            
              <li><a href="/tutorials/tranmodel/time-split/">时段划分</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <span class="nav__sub-title">活动链交通模型</span>
          

          
          <ul>
            
              <li><a href="/tutorials/tranmodel/pop-gen/">人口合成原理</a></li>
            
              <li><a href="/tutorials/tranmodel/pop-gen_use/" class="active">popgen使用</a></li>
            
              <li><a href="/tutorials/tranmodel/pop-gen_file/">popgen文件说明</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <span class="nav__sub-title">智能体交通模型</span>
          

          
          <ul>
            
              <li><a href="/tutorials/tranmodel/matsim-base/">软件介绍</a></li>
            
              <li><a href="/tutorials/tranmodel/matsim-run/">下载与安装</a></li>
            
              <li><a href="/tutorials/tranmodel/matsim-config/">Matsim配置</a></li>
            
              <li><a href="/tutorials/tranmodel/matsim-yuanli/">Matsim原理</a></li>
            
              <li><a href="/tutorials/tranmodel/matsim-celue/">Matsim的策略</a></li>
            
              <li><a href="/tutorials/tranmodel/matsim-Score/">Matsim评分机制</a></li>
            
          </ul>
          
        </li>
      
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="popgen-人口合成">
    <meta itemprop="description" content="1、项目结构及配置参数1.1、项目目录">
    <meta itemprop="datePublished" content="2025-03-07T17:38:38+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="http://localhost:4000/tutorials/tranmodel/pop-gen_use/" itemprop="url">popgen-人口合成
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> 目录</h4></header>
              <ul class="toc__menu"><li><a href="#1项目结构及配置参数">1、项目结构及配置参数</a><ul><li><a href="#11项目目录">1.1、项目目录</a></li><li><a href="#12设置配置文件configuration_whyaml">1.2、设置配置文件：configuration_WH.yaml</a></li></ul></li><li><a href="#2操作步骤">2、操作步骤</a></li><li><a href="#3备注说明">3、备注说明</a></li></ul>
            </nav>
          </aside>
        
        <h2 id="1项目结构及配置参数">1、项目结构及配置参数</h2>
<h3 id="11项目目录">1.1、项目目录</h3>

<pre><code class="language-buildoutcfg">|-vennv            # python环境
├─popgen2          # popgen的项目
|    ├─config.py
|    ├─data.py
|    ├─draw.py
|    ├─ipf.py
|    ├─output.py
|    ├─project.py
|    ├─reweighting.py
|    ├─__init__.py
|    ├─tutorials         # 项目输入参数
|    |     ├─WH         # 武汉
|    |     | ├─configuration_WH.yaml    # 配置文件
|    |     | ├─geo_sample_mapping.csv   # geo和样本geo的对应关系表
|    |     | ├─household_marginals.csv   # 家庭户的边缘分布表
|    |     | ├─household_sample.csv     # 家庭户样本表
|    |     | ├─labor_marginals.csv         # 集体户边缘分布 
|    |     | ├─labor_sample.csv            # 集体户样本表
|    |     | ├─person_marginals.csv       # 个人边缘分布
|    |     | ├─person_sample.csv          # 个人样本表
|    |     | ├─region_geo_mapping.csv    # region和geo的对应关系表
|    |     | ├─region_household_marginals.csv     # region层家庭户边缘分布
|    |     | ├─region_labor_marginals.csv     # region 层集体户边缘分布
|    |     | ├─region_person_marginals.csv   # rengion层个体边缘分布
|    |     | ├─region_sample_mapping.csv    # region层样本geo的对应关系表
|    |     | ├─2021-01-11 20-09-52 WH-TAZ Scenario   # 输出结果文件夹
|    |     | |                  ├─draws.csv       # 抽样
|    |     | |                  ├─housing_synthetic.csv     # 家庭户虚拟人口
|    |     | |                  ├─ipf_geo_average_diffs_household.csv    # ipf计算出来的geo层家庭户平均偏差
|    |     | |                  ├─ipf_geo_average_diffs_labor.csv     # ipf计算出来的geo层集体平均偏差
|    |     | |                  ├─ipf_geo_average_diffs_person.csv   # ipf计算出来的geo层个体平均偏差
|    |     | |                  ├─ipf_region_average_diffs_household.csv   # ipf计算出来的region层家庭户平均偏差
|    |     | |                  ├─ipf_region_average_diffs_labor.csv     # ipf计算出来的region层集体户平均偏差
|    |     | |                  ├─ipf_region_average_diffs_person.csv   # ipf计算出来的region层个体平均偏差
|    |     | |                  ├─person_synthetic.csv    # 生成虚拟的人口
|    |     | |                  ├─reweighting_average_diffs.csv   # 调整权值后的平均偏差
|    |     | |                  ├─rpage_rpwh.csv # region层年龄和常驻人口统计分布
|    |     | |                  ├─rpsex_rpage.csv  # region层性别和年龄统计分布
|    |     | |                  ├─rpsex_rpwh.csv  # region层性别和常驻人口分布
|    |     | |                  ├─summary_geo.csv  # geo层总体统计
|    |     | |                  ├─summary_region.csv  # region层总体统计
|    |     | |                  ├─weights.csv  # 权值
|    |     | |                  └WH-TAZ Scenario.yaml  # 项目配置
</code></pre>

<h3 id="12设置配置文件configuration_whyaml">1.2、设置配置文件：configuration_WH.yaml</h3>
<pre><code class="language-buildoutcfg">project:  #项目设置
#To generate a synthetic population
 synthesize: True 
 name: WH_Synthetic_Population
#File location
 location: .\tutorials\WH/   # 输入文件路径
#Setup input data with given forms
 inputs: # 输入参数
  entities: [household, labor, person]  # 实体对象：家庭户，集体户，个人
  housing_entities: [household,labor]  # 家庭实体：家庭户，集体户
  person_entities: [person]  # 个人实体：个人
  column_names:
   hid: hid  # 家庭户ID
   pid: pid  # 集体户ID
   geo: geo  # geo层ID
   region: region  # region
   sample_geo: sample_geo  # 样本geo
  location:  # csv文件位置和名称
   geo_corr_mapping:  # 映射关系表
    # geo层，geoID和样本geo的对应关系
    geo_to_sample: geo_sample_mapping.csv
    # region层：region的id数
    region_to_sample: region_sample_mapping.csv
    # region层：region ID对应geo的ID
    region_to_geo: region_geo_mapping.csv
   sample:  # 样本表
    household: household_sample.csv
    person: person_sample.csv
    labor: labor_sample.csv
   marginals: # 边缘分布表
    region:  # region层的边缘分布
     household: region_household_marginals.csv
     person: region_person_marginals.csv
     labor: region_labor_marginals.csv
    geo:  # geo层的边缘分布
     household: household_marginals.csv
     person: person_marginals.csv
     labor: labor_marginals.csv
#Start to provide scenario
 scenario:  # 场景设置
#Brief description
  - description: WH-TAZ Scenario
#If control variables are applied in multi-environment (geo and region), true
    apply_region_controls: True  
#Based on input setting, write down header name for each value
    control_variables:  # 控制属性
     region:  # region层
      household: [hhrtotals,rhsize,rtype]  # 家庭户总数，家庭户规模，家庭户住宅属性
      labor:  [rltotals]  # 集体户总人数
      person: [rptotals,rpage,rpsex,rpwh]  # region层总人数，region层不同年龄人数，不同性别人数，常驻人口数
     geo:  # geo层
      household: [hhtotals,hsize,htype]  # 家庭户总数，家庭户规模，家庭户住宅属性
      labor: [ltotals]  # 集体户总数
      person: [ptotals,page,psex,pwh]  # 总人数，年龄，性别，常驻人口
#Setting for IPF procedure, reweighting, and drawing household samples
    parameters:  # 系统参数
     ipf:  # ipf参数设置
      tolerance: 0.0001  # 公差
      iterations: 100  # 迭代次数
      zero_marginal_correction: 0.00001  # 0值处理
      rounding_procedure: bucket  # 取整处理
      # By using archive_performance_frequency, we can decide stop or go for code (if converge, then stop)
      archive_performance_frequency: 1 
#Select either IPU or Entropy 
     reweighting:  # 权值计算
      procedure: ipu  # IPU方法
      tolerance: 0.0001  # 公差
      # standard error comparsion for next weight values
      # Making standard error, and stop when reaching tolerance above
      inner_iterations: 1  # 内循环迭代
      outer_iterations: 100  # 外循环迭代
      archive_performance_frequency: 1  
     draws:
      pvalue_tolerance: 0.9999
      iterations: 25
      seed: 0

    geos_to_synthesize:
     region:
     #Leave empty blank if we synthesize specific region, then use ID
      ids: [1,2]
      all_ids: True
     geo:
      ids: []
      all_ids: True

    outputs:  # 输入文件
     performance: [ipf, reweighting, drawing]
     weights:
      export: True
      collate_across_geos: False
     multiway:
      - variables: [rpsex, rpage]
        filename: rpsex_rpage.csv
        filetype: csv
        entity: person
      - variables: [rpsex, rpwh]
        filename: rpsex_rpwh.csv
        filetype: csv
        entity: person
      - variables: [rpage, rpwh]
        filename: rpage_rpwh.csv
        filetype: csv
        entity: person
     
     summary:
      region:
       filename: summary_region.csv
       filetype: csv
      geo:
       filename: summary_geo.csv
       filetype: csv
     synthetic_population:
      housing:
       filename: housing_synthetic.csv
       filetype: csv
      person:
       filename: person_synthetic.csv
       filetype: csv

</code></pre>

<h2 id="2操作步骤">2、操作步骤</h2>
<ul>
  <li>创建输入参数表
  见popgen文件说明</li>
  <li>配置输入文件</li>
  <li>运行程序
    <pre><code class="language-gitexclude">  ***/vennv/Python27/python.exe ***/popgen2/project.py
</code></pre>
  </li>
</ul>

<h2 id="3备注说明">3、备注说明</h2>
<ul>
  <li>该套程序已经固定好了python的版本和依赖包，不要随便更新版本，新版本不支持程序中的很多旧语法，会出错；</li>
  <li>该程序只支持region和geo层，两层约束；个人，家庭胡，集体户属性不受限制；</li>
</ul>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 更新时间:</strong> <time class="dt-published" datetime="2025-03-07T17:38:38+08:00">March 7, 2025</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/tutorials/tranmodel/pop-gen/" class="pagination--pager" title="人口合成原理
">上一页</a>
    
    
      <a href="/tutorials/tranmodel/pop-gen_file/" class="pagination--pager" title="popgen文件说明
">下一页</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      输入您要搜索的关键词...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="输入您要搜索的关键词..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>关注:</strong></li>
    

    
      
        
          <li><a href="https://github.com/tianchaoyu" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="http://localhost:4000">技术博客</a>. 技术来自于 <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






  </body>
</html>
